import { spring, useCurrentFrame, useVideoConfig } from 'remotion';
import React from 'react';

export const VulnerabilityRevealAnimation: React.FC = () => {
    const frame = useCurrentFrame();
    const { fps } = useVideoConfig();

    // Glitch effect logic
    const glitchOpacity = (frame % 10 < 5) ? 0.1 : 0;

    // Warning badge timing
    const warningStart = 30; // 1s
    const warningProgress = spring({
        frame: frame - warningStart,
        fps,
        config: { damping: 15 }
    });

    // Code shake effect
    const shake = Math.sin(frame * 0.5) * 2;

    return (
        <div className="relative w-full h-full bg-zinc-950 rounded-xl overflow-hidden border border-red-500/20 flex flex-col font-mono text-xl md:text-2xl shadow-2xl">
            {/* Glitch Overlay */}
            <div
                className="absolute inset-0 bg-red-500/5 pointer-events-none z-20"
                style={{ opacity: glitchOpacity }}
            />

            <div className="h-10 bg-zinc-900 border-b border-red-500/20 flex items-center px-4 justify-between">
                <div className="text-sm text-red-400 flex items-center gap-2">
                    <div className="w-2 h-2 rounded-full bg-red-500" style={{ opacity: Math.sin(frame * 0.2) > 0 ? 1 : 0.5 }} />
                    INSECURE_CONFIG.tsx
                </div>
            </div>

            <div className="p-8 text-zinc-400 space-y-4 relative z-10">
                <div className="opacity-50">const config = {'{'}</div>

                {/* Leaked Key */}
                <div
                    className="pl-8 py-1 bg-red-500/10 border-l-2 border-red-500 text-red-200"
                    style={{ transform: `translateX(${shake}px)` }}
                >
                    apiKey: "sk_live_8923...",
                </div>

                <div className="pl-8">db_password: "admin123",</div>
                <div className="opacity-50">{'}'};</div>

                {/* Warning Badge */}
                <div
                    className="absolute bottom-8 right-8 bg-red-950 border border-red-500 text-red-500 px-4 py-2 rounded-md text-sm font-bold flex items-center gap-2 shadow-[0_0_20px_rgba(239,68,68,0.3)]"
                    style={{
                        opacity: warningProgress,
                        transform: `translateY(${(1 - warningProgress) * 20}px)`
                    }}
                >
                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    CRITICAL LEAK
                </div>
            </div>
        </div>
    );
};

"use strict";(()=>{var D=Object.defineProperty,C=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var S=(s,n,i)=>n in s?D(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i,_=(s,n)=>{for(var i in n||(n={}))B.call(n,i)&&S(s,i,n[i]);if(w)for(var i of w(n))$.call(n,i)&&S(s,i,n[i]);return s},A=(s,n)=>C(s,q(n));(function(){"use strict";let s="https://vlffoepzknlbyxhkmwmn.supabase.co/functions/v1/threat-ingest",T=document.querySelectorAll("script[data-token]"),f="";for(let t=0;t<T.length;t++){let e=T[t].getAttribute("data-token");if(e&&e.startsWith("cvt_")){f=e;break}}if(!f)return;let r=[];function o(t){r.length>=200&&r.shift(),r.push(A(_({},t),{path:location.pathname+location.search,timestamp:new Date().toISOString()}))}let d=3;function h(t=0){if(r.length===0)return;let e=r.splice(0,50),a=JSON.stringify({token:f,events:e});if(t===0&&document.visibilityState==="hidden"&&navigator.sendBeacon){let c=new Blob([a],{type:"application/json"});navigator.sendBeacon(s,c);return}try{fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:a,keepalive:!0}).then(c=>{!c.ok&&t<d&&(r.unshift(...e),setTimeout(()=>h(t+1),Math.pow(2,t)*1e3))}).catch(()=>{t<d&&(r.unshift(...e),setTimeout(()=>h(t+1),Math.pow(2,t)*1e3))})}catch(c){t<d&&(r.unshift(...e),setTimeout(()=>h(t+1),Math.pow(2,t)*1e3))}}setInterval(h,5e3),typeof document!="undefined"&&(document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&h()}),window.addEventListener("pagehide",()=>h()));let R=[/<script[\s>]/i,/javascript\s*:/i,/on(error|load|click|mouseover|focus|blur)\s*=/i,/<iframe[\s>]/i,/<img[^>]+onerror\s*=/i,/<svg[^>]+onload\s*=/i,/<iframe[^>]+src\s*=\s*["']?javascript:/i,/<body[^>]+onload\s*=/i,/document\.(cookie|domain|write)/i,/window\.(location|open)\s*=/i,/eval\s*\(/i,/setTimeout\s*\(\s*["'`]/i,/setInterval\s*\(\s*["'`]/i,/\.innerHTML\s*=/i,/fromCharCode/i,/\balert\s*\(/i,/\bprompt\s*\(/i,/\bconfirm\s*\(/i,/&#x?[0-9a-f]+;/i];function g(t){return R.some(e=>e.test(t))}function b(){new URLSearchParams(location.search).forEach((e,a)=>{g(e)&&o({type:"xss",severity:"critical",payload:`param[${a}]=${e.slice(0,200)}`})}),location.hash&&g(decodeURIComponent(location.hash))&&o({type:"xss",severity:"high",payload:`hash=${location.hash.slice(0,200)}`})}let L=[/UNION\s+(ALL\s+)?SELECT/i,/OR\s+1\s*=\s*1/i,/['"];?\s*DROP\s/i,/SLEEP\s*\(\d+\)/i,/BENCHMARK\s*\(/i,/WAITFOR\s+DELAY/i,/;\s*SELECT\s/i,/;\s*(DROP|ALTER|CREATE|TRUNCATE|DELETE|INSERT|UPDATE)\s/i,/'\s*OR\s+'[^']*'\s*=\s*'/i,/'\s*AND\s+'[^']*'\s*=\s*'/i,/INTO\s+(OUT|DUMP)FILE/i,/LOAD_FILE\s*\(/i,/information_schema/i,/CHAR\s*\(\d+/i,/0x[0-9a-fA-F]{8,}/i,/--\s*$/,/\/\*.*\*\//,/'\s+OR\s+'/i];function y(t){return L.some(e=>e.test(t))}function k(){new URLSearchParams(location.search).forEach((e,a)=>{y(e)&&o({type:"sqli",severity:"critical",payload:`param[${a}]=${e.slice(0,200)}`})})}let U=[/\.\.\//,/\.\.%2[fF]/,/\/etc\/passwd/i,/\/etc\/shadow/i,/\/proc\/self/i,/\/windows\/system32/i];function I(){let t=location.href;for(let e of U)if(e.test(t)){o({type:"path_traversal",severity:"high",payload:t.slice(0,300)});return}}function O(){let t=[];navigator.webdriver&&t.push("webdriver=true"),!window.chrome&&/Chrome/.test(navigator.userAgent)&&t.push("phantom_chrome"),(window._phantom||window.__nightmare)&&t.push("phantom_nightmare"),(!navigator.languages||navigator.languages.length===0)&&t.push("no_languages"),t.length>=2&&o({type:"bot",severity:"medium",payload:t.join(", "),metadata:{userAgent:navigator.userAgent}})}let p=[],M=5,N=6e4;function F(){document.addEventListener("submit",t=>{var u;let e=t.target;if(!e||!e.querySelector||!e.querySelector('input[type="password"]'))return;let c=Date.now();for(p.push(c);p.length>0&&p[0]<c-N;)p.shift();p.length>M&&o({type:"brute_force",severity:"high",payload:`${p.length} login attempts in 60s`,metadata:{action:(u=e.action)==null?void 0:u.slice(0,200)}}),e.querySelectorAll("input:not([type=password]):not([type=hidden])").forEach(E=>{let l=E.value;l&&g(l)&&o({type:"xss",severity:"critical",payload:`form_input=${l.slice(0,200)}`}),l&&y(l)&&o({type:"sqli",severity:"critical",payload:`form_input=${l.slice(0,200)}`})})},!0)}let H=["stripe.com","paypal.com","braintreegateway.com","checkout.shopify.com","accounts.google.com","login.microsoftonline.com","appleid.apple.com","github.com","auth0.com"];function P(){document.addEventListener("submit",t=>{let e=t.target;if(!(!e||!e.action))try{if((e.method||"GET").toUpperCase()==="GET")return;let m=new URL(e.action).hostname,u=location.hostname,E=m.split(".").slice(-2).join("."),l=u.split(".").slice(-2).join(".");if(E===l||H.some(v=>m===v||m.endsWith("."+v)))return;e.querySelector('input[name*="csrf"], input[name*="token"], input[name*="_token"], input[name*="authenticity"]')||o({type:"csrf",severity:"high",payload:`cross-domain POST to ${m}`})}catch(a){}},!0)}try{b(),k(),I(),O(),F(),P()}catch(t){}})();})();

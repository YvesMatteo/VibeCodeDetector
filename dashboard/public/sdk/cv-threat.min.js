"use strict";(()=>{var H=Object.defineProperty,M=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var E=(i,n,s)=>n in i?H(i,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[n]=s,v=(i,n)=>{for(var s in n||(n={}))P.call(n,s)&&E(i,s,n[s]);if(y)for(var s of y(n))q.call(n,s)&&E(i,s,n[s]);return i},_=(i,n)=>M(i,N(n));(function(){"use strict";let i="https://vlffoepzknlbyxhkmwmn.supabase.co/functions/v1/threat-ingest",f=document.querySelectorAll("script[data-token]"),h="";for(let e=0;e<f.length;e++){let t=f[e].getAttribute("data-token");if(t&&t.startsWith("cvt_")){h=t;break}}if(!h)return;let l=[];function o(e){l.length>=200||l.push(_(v({},e),{path:location.pathname+location.search,timestamp:new Date().toISOString()}))}function p(){if(l.length===0)return;let e=l.splice(0,50),t=JSON.stringify({token:h,events:e});if(navigator.sendBeacon){let a=new Blob([t],{type:"application/json"});navigator.sendBeacon(i,a)}else try{fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:t,keepalive:!0}).catch(()=>{})}catch(a){}}setInterval(p,5e3),typeof document!="undefined"&&(document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&p()}),window.addEventListener("pagehide",p));let S=[/<script[\s>]/i,/javascript\s*:/i,/on(error|load|click|mouseover|focus|blur)\s*=/i,/<iframe[\s>]/i,/<img[^>]+onerror/i,/document\.(cookie|write|location)/i,/eval\s*\(/i,/\balert\s*\(/i,/\bString\.fromCharCode/i,/&#x?[0-9a-f]+;/i];function u(e){return S.some(t=>t.test(e))}function T(){new URLSearchParams(location.search).forEach((t,a)=>{u(t)&&o({type:"xss",severity:"critical",payload:`param[${a}]=${t.slice(0,200)}`})}),location.hash&&u(decodeURIComponent(location.hash))&&o({type:"xss",severity:"high",payload:`hash=${location.hash.slice(0,200)}`})}let w=[/UNION\s+(ALL\s+)?SELECT/i,/OR\s+1\s*=\s*1/i,/['"];?\s*DROP\s/i,/SLEEP\s*\(/i,/BENCHMARK\s*\(/i,/WAITFOR\s+DELAY/i,/;\s*SELECT\s/i,/--\s*$/,/\/\*.*\*\//,/'\s+OR\s+'/i];function d(e){return w.some(t=>t.test(e))}function A(){new URLSearchParams(location.search).forEach((t,a)=>{d(t)&&o({type:"sqli",severity:"critical",payload:`param[${a}]=${t.slice(0,200)}`})})}let b=[/\.\.\//,/\.\.%2[fF]/,/\/etc\/passwd/i,/\/etc\/shadow/i,/\/proc\/self/i,/\/windows\/system32/i];function L(){let e=location.href;for(let t of b)if(t.test(e)){o({type:"path_traversal",severity:"high",payload:e.slice(0,300)});return}}function R(){let e=[];navigator.webdriver&&e.push("webdriver=true"),!window.chrome&&/Chrome/.test(navigator.userAgent)&&e.push("phantom_chrome"),(window._phantom||window.__nightmare)&&e.push("phantom_nightmare"),(!navigator.languages||navigator.languages.length===0)&&e.push("no_languages"),e.length>=2&&o({type:"bot",severity:"medium",payload:e.join(", "),metadata:{userAgent:navigator.userAgent}})}let r=[],C=5,k=6e4;function U(){document.addEventListener("submit",e=>{var g;let t=e.target;if(!t||!t.querySelector||!t.querySelector('input[type="password"]'))return;let m=Date.now();for(r.push(m);r.length>0&&r[0]<m-k;)r.shift();r.length>C&&o({type:"brute_force",severity:"high",payload:`${r.length} login attempts in 60s`,metadata:{action:(g=t.action)==null?void 0:g.slice(0,200)}}),t.querySelectorAll("input:not([type=password]):not([type=hidden])").forEach(O=>{let c=O.value;c&&u(c)&&o({type:"xss",severity:"critical",payload:`form_input=${c.slice(0,200)}`}),c&&d(c)&&o({type:"sqli",severity:"critical",payload:`form_input=${c.slice(0,200)}`})})},!0)}function I(){document.addEventListener("submit",e=>{let t=e.target;if(!(!t||!t.action))try{let a=new URL(t.action).origin;a!==location.origin&&(t.querySelector('input[name*="csrf"], input[name*="token"], input[name*="_token"], input[name*="authenticity"]')||o({type:"csrf",severity:"high",payload:`cross-origin form submit to ${a}`}))}catch(a){}},!0)}try{T(),A(),L(),R(),U(),I()}catch(e){}})();})();
